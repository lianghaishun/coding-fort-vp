# æ‰‘å…‹ç‰Œ

```js
function Poker(point, color) {
  this.point = point;
  this.color = color;
}
function Deck(type = 0) {
  const count = type === 1 ? 52 : 54;
  const customPoints = [
    "A",
    "2",
    "3",
    "4",
    "5",
    "6",
    "7",
    "8",
    "9",
    "10",
    "J",
    "Q",
    "K",
  ];
  const curtomColors = ["â™¦ï¸", "â™£ï¸", "â™¥ï¸", "â™ ï¸"];
  const jokerPoint = "Joker";
  const jokerColors = ["ğŸ¤¡", "ğŸƒ"];
  this.cards = [];
  this.init = () => {
    for (let i = 0, len = count; i < len; ) {
      // æ™®é€šç‰Œ
      curtomColors.forEach((color) => {
        customPoints.forEach((point) => {
          this.cards.push(new Poker(point, color));
          i++;
        });
      });
      // å¤§å°ç‹
      type === 0 &&
        jokerColors.forEach((color) => {
          this.cards.push(new Poker(jokerPoint, color));
          i++;
        });
    }
  };
  this.wash = () => {
    this.cards = this.cards.sort((a, b) => (Math.random() > 0.5 ? -1 : 1));
  };
}

function Play() {
  const playerCount = 4;
  this.playerCards = [
    { name: "zhang", cards: [] },
    { name: "li", cards: [] },
    { name: "qian", cards: [] },
    { name: "wu", cards: [] },
  ];
  const deck = new Deck(1);
  deck.init();
  deck.wash();
  const cards = deck.cards;
  let current = 0;
  cards.forEach((card, index) => {
    this.playerCards[current].cards.push(card);
    if (current < playerCount - 1) current++;
    else current = 0;
  });

  // æ‰“ç‰Œ
  this.playing = () => {
    // éšæœºç”Ÿæˆä¸€ä¸ªæ•°å­—ï¼Œå†³å®šé‚£ä¸ªå…ˆå‡ºç‰Œ
    let currentPlayerIndex = Math.floor(Math.random() * playerCount);

    // å®šä¹‰ç‰Œé¢å¤§å°å’ŒèŠ±è‰²çš„é¡ºåº
    const pointOrder = [
      "3",
      "4",
      "5",
      "6",
      "7",
      "8",
      "9",
      "10",
      "J",
      "Q",
      "K",
      "A",
      "2",
    ];
    const colorOrder = ["â™¦ï¸", "â™£ï¸", "â™¥ï¸", "â™ ï¸"];

    // åˆ¤æ–­ç‰Œé¢å¤§å°
    function compareCards(card1, card2) {
      let point1Index = pointOrder.indexOf(card1.point);
      let point2Index = pointOrder.indexOf(card2.point);
      if (point1Index !== point2Index) return point1Index > point2Index;
      return colorOrder.indexOf(card1.color) > colorOrder.indexOf(card2.color);
    }

    // æ¸¸æˆç»“æŸæ ‡å¿—
    let gameEnded = false;

    // æ¸¸æˆå¾ªç¯
    const gameLoop = () => {
      if (gameEnded) return; // å¦‚æœæ¸¸æˆå·²ç»ç»“æŸï¼Œç›´æ¥è¿”å›

      console.log(`å½“å‰è½®åˆ° ${this.playerCards[currentPlayerIndex].name} å‡ºç‰Œ`);

      // å½“å‰ç©å®¶å‡ºæœ€å°çš„ç‰Œ
      let currentCard = this.playerCards[currentPlayerIndex].cards.shift();
      if (!currentCard) {
        console.log("æ¸¸æˆç»“æŸï¼Œæ²¡æœ‰ç©å®¶å¯ä»¥ç»§ç»­å‡ºç‰Œ");
        return;
      }

      setTimeout(() => {
        console.log(
          `${this.playerCards[currentPlayerIndex].name} å‡ºäº† ${currentCard.point}${currentCard.color}`
        );

        // æ£€æŸ¥æ˜¯å¦æœ‰ç©å®¶å·²ç»æ‰“å®Œæ‰€æœ‰ç‰Œ
        for (let i = 0; i < playerCount; i++) {
          if (this.playerCards[i].cards.length === 0) {
            console.log(`${this.playerCards[i].name} èµ¢å¾—äº†æ¯”èµ›ï¼`);
            gameEnded = true; // è®¾ç½®æ¸¸æˆç»“æŸæ ‡å¿—
            return;
          }
        }

        // æ£€æŸ¥å…¶ä»–ç©å®¶æ˜¯å¦æœ‰æ›´å¤§çš„ç‰Œå¯ä»¥å‡º
        let found = false; // åˆå§‹åŒ– found ä¸º false
        for (let i = 0; i < playerCount; i++) {
          if (i === currentPlayerIndex) continue;

          for (let j = 0; j < this.playerCards[i].cards.length; j++) {
            if (compareCards(this.playerCards[i].cards[j], currentCard)) {
              setTimeout(() => {
                console.log(
                  `${this.playerCards[i].name} å¯ä»¥è·Ÿä¸Š ${this.playerCards[i].cards[j].point}${this.playerCards[i].cards[j].color}`
                );
                this.playerCards[i].cards.splice(j, 1); // ç§»é™¤å·²å‡ºçš„ç‰Œ
                currentPlayerIndex = i; // æ›´æ–°å½“å‰ç©å®¶
                found = true;
                gameLoop(); // ç»§ç»­æ¸¸æˆå¾ªç¯
              }, 1000 + Math.floor(Math.random() * 2000)); // 1-3ç§’çš„å»¶è¿Ÿ
              return;
            }
          }
          if (found) break;
        }

        // å¦‚æœæ²¡æœ‰äººèƒ½æ¥ä¸Šï¼Œåˆ™ä¸‹ä¸€ä¸ªç©å®¶å‡ºç‰Œ
        if (!found) {
          setTimeout(() => {
            currentPlayerIndex = (currentPlayerIndex + 1) % playerCount;
            gameLoop(); // ç»§ç»­æ¸¸æˆå¾ªç¯
          }, 1000 + Math.floor(Math.random() * 2000)); // 1-3ç§’çš„å»¶è¿Ÿ
        }
      }, 1000 + Math.floor(Math.random() * 2000)); // 1-3ç§’çš„å»¶è¿Ÿ
    };

    // å¼€å§‹æ¸¸æˆå¾ªç¯
    gameLoop();
  };
}

// åˆ›å»ºå¹¶å¼€å§‹æ¸¸æˆ
const game = new Play();
game.playing();
```
