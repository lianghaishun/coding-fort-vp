# npm 与 yarn 对比

`npm` 和 `Yarn` 是 JavaScript 生态系统中最常用的两个包管理工具。它们都用于安装、更新、配置和卸载项目依赖项，但各自具有一些独特的特性和差异。了解这些差异可以帮助开发者根据具体需求选择最适合的工具。

## npm (Node Package Manager)

### 简介

- **官方支持**：由 Node.js 团队维护，是 Node.js 的默认包管理器。
- **历史**：出现较早，拥有庞大的社区支持和丰富的插件生态系统。

### 主要特点

- **性能**：随着时间的发展，npm 在性能方面有了显著提升，特别是在 v5 之后引入了锁文件 (`package-lock.json`)。
- **锁定文件**：从 npm v5 开始，自动创建 `package-lock.json` 文件，确保所有开发者使用相同的依赖版本。
- **全局安装**：提供了全局安装选项，方便在不同项目之间共享工具。
- **脚本命令**：内置对 npm 脚本的支持，可以直接通过 `npm run <script>` 执行定义在 `package.json` 中的脚本。
- **安全性**：提供安全公告和审计功能（`npm audit`），帮助识别和修复潜在的安全漏洞。

### 使用示例

```bash
# 初始化项目
npm init

# 安装依赖
npm install <package-name>

# 安装开发依赖
npm install <package-name> --save-dev

# 运行脚本
npm run <script-name>
```

## Yarn

### 简介

- **背景**：由 Facebook 开发并开源，旨在解决 npm 在性能和一致性方面的一些局限性。
- **优势**：更快的安装速度、更可靠的依赖解析以及更好的安全性。

### 主要特点

- **性能**：通过并行下载和缓存机制，Yarn 提供了比早期版本 npm 更快的安装速度。
- **锁定文件**：自动生成 `yarn.lock` 文件，确保所有开发者使用相同的依赖版本。
- **离线模式**：如果曾经安装过某个包，即使没有网络连接也可以再次安装。
- **确定性安装**：每次安装都会产生相同的结果，避免了因不同环境导致的依赖问题。
- **工作区支持**：对于大型项目或 monorepos（多包仓库），Yarn 支持工作区功能，允许在一个命令中同时管理多个包。
- **插件系统**：Yarn 拥有丰富的插件生态，可以扩展其核心功能。

### 使用示例

```bash
# 初始化项目
yarn init

# 安装依赖
yarn add <package-name>

# 安装开发依赖
yarn add <package-name> --dev

# 运行脚本
yarn <script-name>
```

## npm vs Yarn: 关键差异

| 特性           | npm                            | Yarn                       |
| -------------- | ------------------------------ | -------------------------- |
| **安装速度**   | 较慢（早期版本），v5+ 显著提升 | 快速，得益于并行下载和缓存 |
| **锁定文件**   | `package-lock.json`（v5+）     | `yarn.lock`                |
| **离线模式**   | 不支持                         | 支持                       |
| **确定性安装** | 依赖于 `package-lock.json`     | 内置特性                   |
| **工作区支持** | 需要额外配置                   | 内置支持                   |
| **插件系统**   | 有限                           | 丰富                       |

## 如何选择？

- **如果你已经熟悉 npm 并且对其性能满意**，并且不需要特别的功能，那么继续使用 npm 是一个不错的选择。npm 的社区资源非常广泛，几乎所有的 JavaScript 库都可以通过 npm 获取。
- **如果你希望获得更快的安装速度、更严格的依赖管理和更好的工作区支持**，特别是对于大型项目或 monorepo 结构，Yarn 可能是一个更好的选择。此外，Yarn 的离线模式也使得它在网络不稳定的情况下更加可靠。

## 共存与迁移

实际上，npm 和 Yarn 可以共存于同一个环境中，因为它们都读取 `package.json` 文件，并且不会相互干扰。如果你想从 npm 切换到 Yarn 或反之亦然，通常只需要替换命令前缀（例如，将 `npm install` 替换为 `yarn`），并且注意处理好锁定文件（如 `package-lock.json` 和 `yarn.lock`）之间的转换。

## 总结

无论是 npm 还是 Yarn，都是优秀的包管理工具，各有优劣。选择哪一个取决于你的个人偏好、团队习惯以及项目的具体需求。随着两者不断改进和发展，很多差距正在缩小，因此最重要的是找到适合你工作流的工具。如果你还有其他关于 npm 或 Yarn 的具体问题或需要进一步的帮助，请随时告诉我！
